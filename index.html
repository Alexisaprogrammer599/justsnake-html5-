<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Snake Retro Square Fixed</title>
<style>
  body { margin:0; padding:0; background:#000; color:#0f0; text-align:center; font-family:monospace; }
  canvas { display:block; margin:20px auto; background:#111; }
  #scoreboard { color:#0f0; font-family:monospace; margin-top:5px; }
</style>
</head>
<body>
<h1>Snake Retro</h1>
<canvas id="gameCanvas"></canvas>
<div id="scoreboard">
  <span id="score">Score: 0</span> &nbsp;|&nbsp; 
  <span id="highscore">Highscore: 0</span>
</div>
<script>
var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
var canvas = document.getElementById('gameCanvas');
var ctx = canvas.getContext('2d');
var gridSize = 10;
var size = isMobile ? Math.min(window.innerWidth, window.innerHeight*0.6) : 240;
canvas.width = size;
canvas.height = size;

var snake, dx, dy, apple, score, highscore, gameOver;
highscore = 0;

// Mobile swipe controls
var touchStartX, touchStartY;
if(isMobile){
  canvas.addEventListener('touchstart', function(e){
    var t = e.touches[0];
    touchStartX = t.clientX; touchStartY = t.clientY;
  });
  canvas.addEventListener('touchend', function(e){
    var t = e.changedTouches[0];
    var dxTouch = t.clientX - touchStartX;
    var dyTouch = t.clientY - touchStartY;
    if(Math.abs(dxTouch) > Math.abs(dyTouch)){
      if(dxTouch>0 && dx===0){dx=1; dy=0;}
      if(dxTouch<0 && dx===0){dx=-1; dy=0;}
    }else{
      if(dyTouch>0 && dy===0){dx=0; dy=1;}
      if(dyTouch<0 && dy===0){dx=0; dy=-1;}
    }
  });
}

// Keyboard controls
document.onkeydown = function(e){
  if(e.keyCode==37 && dx===0){dx=-1; dy=0;}
  if(e.keyCode==38 && dy===0){dx=0; dy=-1;}
  if(e.keyCode==39 && dx===0){dx=1; dy=0;}
  if(e.keyCode==40 && dy===0){dx=0; dy=1;}
};

// Initialize or reset game
function resetGame(){
  snake=[{x:Math.floor(canvas.width/(2*gridSize)), y:Math.floor(canvas.height/(2*gridSize))}];
  dx=1; dy=0;
  score=0;
  gameOver=false;

  // Place apple not on snake
  do {
    apple={x:Math.floor(Math.random()*(canvas.width/gridSize)), y:Math.floor(Math.random()*(canvas.height/gridSize))};
  } while(snake.some(seg => seg.x===apple.x && seg.y===apple.y));

  updateScore();
}

// Update scoreboard
function updateScore(){
  document.getElementById('score').textContent = "Score: "+score;
  document.getElementById('highscore').textContent = "Highscore: "+highscore;
}

resetGame();

// Game loop
function gameLoop(){
  if(!gameOver){
    var head = {x: snake[0].x + dx, y: snake[0].y + dy};
    // Walls collision
    if(head.x<0 || head.x>=canvas.width/gridSize || head.y<0 || head.y>=canvas.height/gridSize){
      gameOver=true;
      if(score>highscore) highscore=score;
      setTimeout(resetGame,1000);
    }
    // Self collision
    for(var i=0;i<snake.length;i++){
      if(snake[i].x===head.x && snake[i].y===head.y){
        gameOver=true;
        if(score>highscore) highscore=score;
        setTimeout(resetGame,1000);
      }
    }

    if(!gameOver){
      snake.unshift(head);
      // Eat apple
      if(head.x===apple.x && head.y===apple.y){
        score++;
        updateScore();
        // Place new apple avoiding snake
        do {
          apple={x:Math.floor(Math.random()*(canvas.width/gridSize)), y:Math.floor(Math.random()*(canvas.height/gridSize))};
        } while(snake.some(seg => seg.x===apple.x && seg.y===apple.y));
      }else{
        snake.pop();
      }
    }
  }

  // Draw game
  ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#0f0";
  for(var i=0;i<snake.length;i++){
    ctx.fillRect(snake[i].x*gridSize, snake[i].y*gridSize, gridSize, gridSize);
  }
  ctx.fillStyle="#f00";
  ctx.fillRect(apple.x*gridSize, apple.y*gridSize, gridSize, gridSize);

  // Draw walls
  ctx.strokeStyle="#fff";
  ctx.lineWidth=2;
  ctx.strokeRect(0,0,canvas.width,canvas.height);

  // Game Over text in middle
  if(gameOver){
    ctx.fillStyle="#f00";
    ctx.font="20px monospace";
    ctx.textAlign="center";
    ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
  }
}

setInterval(gameLoop,150);
</script>
</body>
</html>
